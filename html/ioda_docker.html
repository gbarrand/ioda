<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>&lt;h2&gt;Docker&lt;/h2&gt;</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.8.14 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title"><h2>Docker</h2>
</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><br />
</p>
<p>ioda exists under gbarrand/ioda on:</p>
<p><a href="https://hub.docker.com" target="_blank">https://hub.docker.com</a> </p>
<h1><a class="anchor" id="ioda_docker_pull"></a>
docker pull</h1>
<p>To get an image, for example on a Mac: </p><pre class="fragment">     macOS&gt; docker login  # to login on hub.docker.com
     macOS&gt; docker pull gbarrand/ioda:&lt;version&gt;
</pre><p> On some platforms, you may have to "sudo" the upper commands.</p>
<h1><a class="anchor" id="ioda_docker_x11"></a>
Setup X11 and run on macOS before Mojave</h1>
<p>As it is a X11 app, you have to setup the DISPLAY. On a Mac with XQuartz: </p><pre class="fragment">     macOS&gt; ifconfig  # to get your IP address.
        sh&gt; DISPLAY=&lt;IP&gt;:0;export DISPLAY
     ( csh&gt; setenv DISPLAY &lt;IP&gt;:0 )
     macOS&gt; xhost + &lt;IP&gt;
     macOS&gt; docker run -e DISPLAY=${DISPLAY} -v /tmp/.X11-unix:/tmp/.X11-unix:rw gbarrand/ioda:&lt;version&gt;
</pre><h1><a class="anchor" id="ioda_docker_x11_mojave"></a>
Setup X11 and run on macOS with Mojave</h1>
<p>The upper does not work on Mojave, but the below ansatz, found on stackerflow, works for us : </p><pre class="fragment">    mojave&gt; &lt;open a new terminal&gt;
    movaje&gt; &lt;install socat. We installed it with Macports by doing "sudo port install socat"&gt;
    movaje&gt; &lt;be sure that the socat app is in your path&gt;
</pre><p> Check that the port 6000 is not used with : </p><pre class="fragment">    mojave&gt; lsof -i TCP:6000
</pre><p> then do : </p><pre class="fragment">   socat TCP-LISTEN:6000,reuseaddr,fork UNIX-CLIENT:\"$DISPLAY\" &amp;
</pre><p> then another "lsof -i TCP:6000" should give something as : </p><pre class="fragment">   COMMAND   PID    USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME
   socat   23420 barrand    5u  IPv4 0x4e5bb941508d0a39      0t0  TCP *:6000 (LISTEN)
</pre><p> and then, the following command works for us : </p><pre class="fragment">   docker run -e DISPLAY=docker.for.mac.host.internal:0 -v /tmp/.X11-unix:/tmp/.X11-unix:rw -t -i gbarrand/ioda:&lt;version&gt;
</pre><h1><a class="anchor" id="ioda_docker_x11_before_mojave"></a>
Setup X11 and run on macOS before Mojave</h1>
<p>On a Windows-10 with the X11/Xming server, from XLaunch, start Xming with "on" in the "No Access Control" box, or from the DOS prompt : </p><pre class="fragment">    DOS&gt; Xming :0 -multiwindow -clipboard -ac
 (you may have to kill Xming from "Task manager"), and :
    DOS&gt; docker run -e DISPLAY=10.0.75.1:0 gbarrand/ioda:&lt;version&gt;
</pre><h1><a class="anchor" id="ioda_docker_output"></a>
Getting output whilst running</h1>
<p>If producing a out.jpg or out.png with the export menu item, you can get it on your host with: </p><pre class="fragment">     macOS&gt; docker ps  # to get the container id.
     macOS&gt; docker cp &lt;container id&gt;:/root/Documents/ioda/out.jpg .
</pre><h1><a class="anchor" id="ioda_docker_mount"></a>
Mount a working directory</h1>
<p>As the /root/Documents/ioda directory is a default directory known by ioda to get files and also to deposit output pictures (through the export menut item), it is interesting to show how to mount it on a local host directory, for example /tmp/work_dir. To do that, for example on a Mac : </p><pre class="fragment">     mkdir -p /tmp/work_dir
     cd /tmp/work_dir
</pre><p> have here some input/data file, for example one taken from github/ioda under the ioda/ioda/comres directory : </p><pre class="fragment">     &lt;get demo.root&gt;
</pre><p>Then launch docker/ioda by mounting /tmp/work_dir on /root/Documents/ioda by adding in the upper docker run command : </p><pre class="fragment">     -v /tmp/work_dir:/app/Documents/ioda:rw
</pre><p> From docker/ioda : </p><pre class="fragment">     files &gt; ioda &gt; .root &gt; demo.root &gt; h20
  produce out.png :
     meta-zone &gt; home &gt; large-down arrow &gt; export &gt; out.png
  then exit with :
     meta-zone &gt; home &gt; short-down arrow &gt; exit
</pre><p> (meta-zone = area at the bottom of the window. When touched/clicked it permits to toggle from screen mode to menut mode).</p>
<p>You should have in the local host /tmp/work_dir a out.png file. </p><div class="image">
<img src="docker.png" alt="docker.png"/>
</div>
<h1><a class="anchor" id="ioda_docker_mount_gopaw"></a>
From 1.14.x, exec a .kumac</h1>
<p>With a ioda having the gopaw core, have in the working directory a my.kumac with : </p><pre class="fragment">     vector/create VECT1(10)
     vector/input VECT1 10 8 6 4 2 3 5 7 9 11
     v/draw vect1
     /picture/print out.png
</pre><p> From docker/ioda : </p><pre class="fragment">     files &gt; ioda &gt; .kumac &gt; my.kumac
</pre><p> You should see : </p><div class="image">
<img src="docker_gopaw.png" alt="docker_gopaw.png"/>
</div>
<h1><a class="anchor" id="ioda_docker_mount_refs"></a>
.kumac refering other files.</h1>
<p>If the .kumac refers a data file or another .kumac file, you have to do a local copy of them and refer them by using the IODA_DATA_DIR environment variable. For example with a my.kumac to work on data_B4.hdf5 file : </p><pre class="fragment">     &lt;get data_B4.hdf5 from github/ioda/comres&gt;
     &lt;get m51.fits&gt;
     &lt;get alldef.kumac&gt;
</pre><p> Have in /tmp/work_dir/my.kumac : </p><pre class="fragment">     exec $IODA_DATA_DIR/alldef
     zone 2 2
     opt stat
     h/file 1 $IODA_DATA_DIR/data_B4.hdf5   | file coming from Geant4.
     cd //lun1/default_histograms
     h/plot Eabs
     h/plot Egap
     h/plot Labs
     h/plot Lgap
     close 1
</pre><p> From docker/ioda : </p><pre class="fragment">     files &gt; ioda &gt; .kumac &gt; my.kumac
</pre><p> You should see : </p><div class="image">
<img src="docker_b4.png" alt="docker_b4.png"/>
</div>
<p>Or to work on the data_m51.fits file, have in a /tmp/work_dir/my.kumac : </p><pre class="fragment">     SET XTIC 0.0001;SET YVAL 100.
     SET YTIC 0.0001;SET XVAL 100.
     NULL 0 2 0 2
     h/file 1 $IODA_DATA_DIR/data_m51.fits  | width = 512, height = 512, mean = 43.8, rms = 37.7, cmap.size = 256
     IMAGE_HDU 1 0 0 200 colbr32 1 1 1 1.2 00 00
</pre><p> From docker/ioda : </p><pre class="fragment">     files &gt; ioda &gt; .kumac &gt; my.kumac
</pre><p> You should see : </p><div class="image">
<img src="docker_m51.png" alt="docker_m51.png"/>
</div>
 </div></div><!-- contents -->

</body>
</html>
